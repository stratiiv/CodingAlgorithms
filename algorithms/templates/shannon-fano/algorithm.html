{% extends 'base.html' %}
{% load static %}
{% block content %}

<!-- Add your HTML code here -->
<div class="container mt-4">
  <h2>Shannon-Fano Encoding</h2>

  <!-- Input field for user to enter data -->
  <div class="mb-3">
    <label for="inputData" class="form-label">Enter Data:</label>
    <input type="text" class="form-control" id="inputData" placeholder="Type your data here">
  </div>

  <button type="button" class="btn btn-primary" onclick="processData()">Encode Data</button>

  <div id="binaryOutput" class="mt-3">
    <strong>Binary Output:</strong> <span id="binaryRepresentation"></span>
  </div>

  <table class="table mt-3">
    <thead>
      <tr>
        <th>Symbol</th>
        <th>ASCII</th>
        <th>Frequency</th>
        <th>Code</th>
      </tr>
    </thead>
    <tbody id="outputTableBody"></tbody>
  </table>

  <!-- Additional Information -->
  <div id="additionalInfo" class="mt-3">
    <strong>Entropy:</strong> <span id="entropy"></span><br>
    <strong>Number of Bits:</strong> <span id="numberOfBits"></span><br>
    <strong>Average Code Length:</strong> <span id="averageCodeLength"></span><br>
    <strong>Code Efficiency:</strong> <span id="codeEfficiency"></span>
  </div>
</div>

<script src="{% static 'shannon-fano/js/index.js' %}"></script>
<script>
  function processData() {
    const inputData = document.getElementById('inputData').value;
    const frequencyMap = new Map(Array.from(inputData, char => [char, 0])); // Initialize frequencies to 0
    for (const char of inputData) {
      frequencyMap.set(char, frequencyMap.get(char) + 1);
    }

    const root = buildShannonFanoTree(inputData);
    const codes = generateCodes(root);

    displayResults(frequencyMap, codes);

    // Display the binary representation of the entire encoded output
    const binaryRepresentation = document.getElementById('binaryRepresentation');
    binaryRepresentation.textContent = Object.values(codes).join('');

    // Calculate and display additional information
    const entropy = calculateEntropy(frequencyMap);
    const numberOfBits = calculateNumberOfBits(codes);
    const averageCodeLength = calculateAverageCodeLength(codes, frequencyMap);
    const codeEfficiency = calculateCodeEfficiency(entropy, averageCodeLength);

    document.getElementById('entropy').textContent = entropy.toFixed(4);
    document.getElementById('numberOfBits').textContent = numberOfBits;
    document.getElementById('averageCodeLength').textContent = averageCodeLength.toFixed(4);
    document.getElementById('codeEfficiency').textContent = codeEfficiency.toFixed(4);
  }

  function displayResults(frequencyMap, codes) {
    const outputTableBody = document.getElementById('outputTableBody');
    outputTableBody.innerHTML = ''; // Clear previous results

    for (const [symbol, frequency] of frequencyMap) {
      const asciiValue = symbol.charCodeAt(0);
      outputTableBody.innerHTML += `
        <tr>
          <td>${symbol}</td>
          <td>${asciiValue}</td>
          <td>${frequency}</td>
          <td>${codes[symbol]}</td>
        </tr>
      `;
    }
  }

  function calculateEntropy(frequencyMap) {
    const totalFrequency = Array.from(frequencyMap.values()).reduce((total, freq) => total + freq, 0);
    return Array.from(frequencyMap.values())
      .reduce((entropy, freq) => entropy - (freq / totalFrequency) * Math.log2(freq / totalFrequency), 0);
  }

  function calculateNumberOfBits(codes) {
    return Object.values(codes).join('').length;
  }

  function calculateAverageCodeLength(codes, frequencyMap) {
    const totalFrequency = Array.from(frequencyMap.values()).reduce((total, freq) => total + freq, 0);
    return Array.from(frequencyMap.entries())
      .reduce((averageLength, [symbol, freq]) => averageLength + (freq / totalFrequency) * codes[symbol].length, 0);
  }

  function calculateCodeEfficiency(entropy, averageCodeLength) {
    return entropy / averageCodeLength;
  }
</script>

{% endblock %}
